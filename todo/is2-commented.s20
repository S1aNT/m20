;
; Тексты интерпретирующей системы ИС-2.
;

; Биты условного числа для команды МА
ЗП              .это    00004   ; запись
МБ              .это    00010   ; барабан
МЛ              .это    00020   ; лента
РЛ              .это    00040   ; разметка ленты
ПЧ              .это    00100   ; печать
ПФ              .это    00200   ; перфорация
БО              .это    00400   ; блокировка останова
ОН              .это    01000   ; обратное движение ленты
БК              .это    02000   ; блокировка контроля
БМ              .это    04000	; блокировка памяти

; Записываем ИС-2 на барабан 07500
		ма	ЗП | МБ, 07500, ис2_конец-1
		мб	ис2_начало
		стоп

ис2_начало:	.адрес	07500
		пв	0, обмен, обмен_возврат	; Строка ТХ для СП 00

вызов:		ра	@, вызов_возврат, сохр_ра	; №СП -> РА, РА -> сохр_ра
		и	@, А2, обмен_возврат		; №СП в А2
к7503:		сд	сдвиг_12, обмен_возврат, 07554  ; №СП в А1
начало_тх:	раа	, ис2_начало			; начало ТХ в РА
поиск_тх:	нтж	@, 07554, 07604
		и	А1, 07604			; поиск в ТХ строки с №
		цмо	ис2_начало, поиск_тх, @+1
		пе	, нашли_тх

		ра	, начало_тх			; начало ТХ -> РА
		раа	@-1, @, начало_тх		; начало ТХ -= 1
		нтж	07554, 07715, @-1		; засылка строки для № в ТХ

нашли_тх:	пв	@-1, к7515, 07554		; начало ТХ -> 7554
к7515:		зп
;-----------------------
		ра	@-1, вызов_возврат, 07601
к7517:		и	@-1, неА2, @-1
		слк	@-1, 07601, @-1
сохр_ра:	зп
		пб	, 07554, к7515
;-----------------------
7523:		ра	, начало_тх
7524:		и	@, А2, 07625
7525:		вчк	07625, к7515
7526:		пе	, 07531
7527:		и	@, А1, @
7530:		нтж	@, 07715, @
7531:		цм	ис2_начало, 07524, @+1
;-----------------------
7532:		нтж	07615, 07541
7533:		пе	07615, 07747, 07541
7534:		сдм	07751, 07544, 07607
7535:		сдма	064, 07607, 2
7536:		слк	07541, 2, 2
7537:		вчк	2, начало_тх
;-----------------------
7540:		по	неА2, 07641, 3
7541:		раа	, 07200
7542:		слк	07607, 07724, 07607
7543:		сда	0114, 07541, к7515
7544:		зп
7545:		мб	@, 07544
;-----------------------
7546:		вчбно	к7515, 07716, 07625
7547:		слк	, @, 07544
7550:		и	@, 3
7551:		раа	@+1, @+1, 07554
7552:		по	07544, 07556, 07604
7553:		слк	07554, 07544, 07554
7554:		зп
7555:		пб	07747, 07567, 3
;-----------------------
7556:	*	вчк	07604, 07716, 07601	; А1 - 2000 >= 0?
7557:	*	пе	, 07563
7560:		вчк	07601, 07607
7561:		по	, 07563
;-----------------------
7562:		слбн	07544, 07625, 07544
7563:	*	сдма	064, 07625, 07625
7564:	*	сдма	0114, 07604, 07604
7565:	*	по	, 07556
;-----------------------
7566:		слко	07544, @-1, @-1
7567:		вчк	2, 07554
;-----------------------
7570:		по	  07541,   07546,   07601
7571:		нтж	  07554,        ,   07541
7572:		пв	  к7517,   к7503,   к7515
;-----------------------
7573:		ра	      @,   вызов_возврат,   сохр_ра
7574:		и	      @,   07744,   07604
7575:		и	      @,   07742,   обмен_возврат
7576:		и	      @,   07741,   07607
7577:		пв	    @+1,   07600,   вызов_возврат
7600:		ра	       ,   сохр_ра
7601:		зп
;-----------------------
7602:		пв	  07603,   07573,   07601
7603:		слк	  07604,   07721,   07604
7604:		зп
7605:		цбр	      @,   07554
7606:		слк	  07607,   07724,   07607
7607:		зп
вызов_возврат:
7610:		пв	       ,   07477
7611:		сдма	   0130,   07607,   07604
7612:		слко	  07604,   07713,   07604
7613:		и	  07604,   07744,   07604
7614:		пб	      1,   07600,       2
7615:		раа	       ,   07200
обмен_возврат:
7616:		зп
7617:		вчк	  07625,   07703,   07604
7620:		вчк	  07601,   07615
7621:		пе	  07615,   07625,   07700
7622:		вчк	  07615,   07604
7623:		пе	       ,   07650
7624:		слк	  07601,   07722,   07615
7625:		зп
7626:		сдма	    064,   сохр_ра,   07554
7627:		слк	  07700,   07554,       @
7630:		сдм	  сдвиг_12,   вызов_возврат,   07554
7631:		слк	      @,   07554,       @
7632:		цбр	      @,     @+1
7633:		и	      @,   07742,   07615
7634:		сдма	   0114,       @,   сохр_ра
7635:		сдма	    064,       @,   вызов_возврат
7636:		вчк	  вызов_возврат,   07722,   вызов_возврат
7637:		ра	       ,   сохр_ра
7640:		пв	       ,   07573
7641:		ра	  07777,   начало_тх,   07625
7642:		и	      @,   А2,   07604
7643:		вчк	  07615,   07604,   07601
7644:		вчк	  07601,   07625
7645:		цмо	  вызов,   07642,     @+1
7646:		по	  07601,   07523,   07625
7647:		пб	  07604,   07642,   к7515
7650:		пб	  начало_тх,   обмен,   07541
7651:		зп
7652:		зп
7653:		зп
7654:		зп
7655:		зп
7656:		зп
7657:		зп
7660:		зп
7661:		зп
7662:		зп
7663:		зп
7664:		зп
7665:		зп
7666:		зп
7667:		зп
7670:		зп
7671:		зп
7672:		зп
7673:		зп

7674:		вчк	  ис2_начало,       1,   07767
7675:		вп	  07676,   07676
7676:		раа	      @,        ,   сохр_ра
7677:		пв	    041,   к7503,   обмен_возврат
7700:		раа

7701: 7 77 7777 7777 0000	стоп	    @-1,     @-1,       @
7702: 7 77 7777 0000 7777	стоп	    @-1,       @,     @-1
7703: 0 00 0000 0002 0000	зп	       ,       2
7704: 7 77 0000 7777 7777	стоп	      @,     @-1,     @-1
обмен:
7705: 4 72 0000 7616 7521	ра	      @,   обмен_возврат,   сохр_ра
7706: 2 50 0413 7600 7544	ма	   0413, @+07600,   07544
7707: 0 70 7544 7534 0000	мб	  07544,   07534

7710:		0 77 7777 7777 7777
7711:		1 00 0000 0000 0000
7712:		2 00 0000 0000 0000
7713:		3 00 0000 0000 0000
7714:		4 00 0000 0000 0000
7715:		пв	, обмен, обмен_возврат
7716:		0 00 2000 0000 0000
7717:		7 00 0000 0000 0000
7720:		4 00 7777 7777 7777
7721:		0 00 0000 0000 0001
7722:		0 00 0000 0001 0000
7723:		0 00 0000 0001 0001
7724:		0 00 0001 0000 0000
7725:		0 00 0001 0000 0001
7726:		0 00 0001 0001 0000
7727:		0 00 0001 0001 0001
7730:		7 00 7777 7777 7777
7731:		0 00 0000 0000 7777
А2:		0 00 0000 7777 0000
7733:		0 00 0000 7777 7777
А1:		0 00 7777 0000 0000
7735:		0 00 7777 0000 777777
7736:		0 00 7777 7777 0000
7737:		0 00 7777 7777 777777
7740:		0 77 0000 0000 0000
7741:		1 77 0000 0000 7777
7742:		2 77 0000 7777 0000
		3 77 0000 7777 7777
7744:		4 77 7777 0000 0000
неА2:		5 77 7777 0000 7777
		6 77 7777 7777 0000
7747:		7 77 7777 7777 7777

сдвиг_12:	1 14 0000 0000 0000
7751: 1 30 0000 0000 0000	впбк	       ,        ,       @
7752: 1 44 4000 0000 0000	кор	  04000,        ,       @
7753: 1 45 0000 0000 0000	умнбн	       ,        ,       @
7754: 1 06 7122 7340 6462	слпа	  07122,   07340, @+06462
7755: 1 00 5427 1027 7575	зп	  05427,   01027, @+07575
7756: 1 01 6220 7732 5042	сл	  06220,   07732, @+05042
7757: 0 67 4061 1156 4571	сдц	  04061,   01156,   04571
7760: 1 04 5000 0000 0000	дел	  05000,        ,       @
7761: 1 01 4000 0000 0000	сл	  04000,        ,       @
7762: 1 02 4000 0000 0000	вч	  04000,        ,       @
7763: 1 02 6000 0000 0000	вч	  06000,        ,       @
7764: 1 00 4000 0000 0000	зп	  04000,        ,       @
7765: 0 77 5252 5252 5253	стоп	  05252,   05252,   05253

ис2_вызов:
7766:		раа	  ис2_начало,       @,   начало_тх
7767:		пв	  07674,   ис2_начало,   вызов_возврат
ис2_конец:
